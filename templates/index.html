<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Unificador de Títulos DOCX</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
</head>
<body class="bg-light">
<div class="container py-4">
  <h1 class="h3 mb-3">Unificador de Títulos .docx</h1>

  <ul class="nav nav-tabs" id="srcTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-folder" data-bs-toggle="tab" data-bs-target="#pane-folder" type="button" role="tab">Carpeta local (OneDrive sincronizado)</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-upload" data-bs-toggle="tab" data-bs-target="#pane-upload" type="button" role="tab">Subir .docx</button>
    </li>
  </ul>

  <div class="tab-content border border-top-0 p-3 bg-white" id="srcPanes">
    <!-- Carpeta -->
    <div class="tab-pane fade show active" id="pane-folder" role="tabpanel">
      <div class="mb-3">
        <label class="form-label">Ruta de carpeta</label>
        <input type="text" class="form-control" id="folder" placeholder="Ej: C:\Users\TuUsuario\OneDrive\CarpetaDocx ó /Users/tu/OneDrive/...">
      </div>
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="include_subs" checked>
        <label class="form-check-label" for="include_subs">Incluir subcarpetas</label>
      </div>
      <button class="btn btn-outline-primary" id="btn-scan-folder">Escanear títulos</button>
    </div>

    <!-- Upload -->
    <div class="tab-pane fade" id="pane-upload" role="tabpanel">
      <div class="mb-3">
        <label class="form-label">Selecciona archivos .docx</label>
        <input class="form-control" type="file" id="files" multiple accept=".docx">
      </div>
      <button class="btn btn-outline-primary" id="btn-scan-upload">Subir y escanear títulos</button>
    </div>
  </div>

  <hr class="my-4"/>

  <div class="row g-3 align-items-end">
    <div class="col-md-3">
      <label class="form-label">Nivel</label>
      <select id="level" class="form-select">
        <option value="1" selected>H1</option>
        <option value="2">H2</option>
        <option value="3">H3</option>
      </select>
    </div>
    <div class="col-md-4">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="use_all" checked>
        <label class="form-check-label" for="use_all">Usar todos los títulos del nivel</label>
      </div>
    </div>
    <div class="col-md-5 text-end">
      <span class="badge bg-secondary" id="badge-archivos">0 archivos</span>
      <span class="badge bg-secondary" id="badge-titulos">0 títulos</span>
    </div>
  </div>

  <div class="mt-3 row g-4">
    <div class="col-md-6">
      <label class="form-label">Títulos encontrados</label>
      <select id="titles" class="form-select" multiple size="12"></select>
      <div class="form-text">Si “Usar todos” está marcado, esta selección se ignora.</div>
    </div>
    <div class="col-md-6">
      <label class="form-label">Archivos detectados</label>
      <div class="table-responsive border rounded">
        <table class="table table-sm align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Archivo</th>
              <th class="text-center"># Títulos</th>
              <th class="text-end">Acción</th>
            </tr>
          </thead>
          <tbody id="files-table">
            <tr><td colspan="3" class="text-muted small p-3">Sin datos. Escanea primero.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <div class="form-check">
      <input class="form-check-input" type="radio" name="mode" id="mode_unificado" value="unificado" checked>
      <label class="form-check-label" for="mode_unificado">Unificado (1 Word + 1 Excel) → ZIP</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="radio" name="mode" id="mode_grouped" value="grouped">
      <label class="form-check-label" for="mode_grouped">Un archivo por título (A.docx, B.docx…) → ZIP</label>
    </div>
  </div>

  <div class="mt-4 d-flex gap-2">
    <button class="btn btn-success" id="btn-merge">Generar y descargar ZIP</button>
    <button class="btn btn-outline-secondary" id="btn-clean">Limpiar subidas</button>
  </div>

  <div class="mt-4">
    <pre id="log" class="bg-dark text-light p-3 rounded small" style="height:180px; overflow:auto"></pre>
  </div>
</div>

<!-- Modal Preview -->
<div class="modal fade" id="modalPreview" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Títulos del archivo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <p class="text-muted small" id="preview-file"></p>
        <ul class="list-group" id="preview-list"></ul>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/static/app.js"></script>
</body>
</html>
